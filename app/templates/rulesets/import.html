{% extends "base.html" %}

{% block content %}
<div class="mb-4">
    <a href="/rulesets" class="text-blue-600 hover:text-blue-800 text-sm">‚Üê Zur√ºck zur √úbersicht</a>
</div>

<div class="bg-white shadow rounded-lg p-6 mb-6">
    <h2 class="text-2xl font-bold text-gray-900 mb-6">Regelwerk importieren</h2>

    {% if error %}
    <div class="mb-6 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded" role="alert">
        <strong class="font-bold">Fehler!</strong>
        <span class="block sm:inline">{{ error }}</span>
    </div>
    {% endif %}

    {% if success %}
    <div class="mb-6 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded" role="alert">
        <strong class="font-bold">Erfolg!</strong>
        <span class="block sm:inline">{{ success }}</span>
    </div>
    {% endif %}

    <!-- Tab-Navigation -->
    <div class="border-b border-gray-200 mb-6">
        <nav class="-mb-px flex space-x-8">
            <button
                id="tab-directory"
                class="tab-button border-b-2 border-purple-600 text-purple-600 py-4 px-1 text-sm font-medium"
                onclick="switchTab('directory')"
            >
                üóÇÔ∏è Aus Verzeichnis
            </button>
            <button
                id="tab-upload"
                class="tab-button border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 py-4 px-1 text-sm font-medium"
                onclick="switchTab('upload')"
            >
                YAML-Datei hochladen
            </button>
            <button
                id="tab-github"
                class="tab-button border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 py-4 px-1 text-sm font-medium"
                onclick="switchTab('github')"
            >
                GitHub-URL importieren
            </button>
            <button
                id="tab-manual"
                class="tab-button border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 py-4 px-1 text-sm font-medium"
                onclick="switchTab('manual')"
            >
                Manuell eingeben
            </button>
        </nav>
    </div>

    <!-- Directory Scan -->
    <div id="content-directory" class="tab-content">
        <div class="text-center py-8">
            <svg class="mx-auto h-16 w-16 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
            </svg>
            <h3 class="mt-4 text-lg font-medium text-gray-900">Regelwerke aus Projektverzeichnis laden</h3>
            <p class="mt-2 text-sm text-gray-600 max-w-md mx-auto">
                Durchsuchen Sie die lokalen Verzeichnisse nach verf√ºgbaren Regelwerk-YAML-Dateien und w√§hlen Sie eines zum Importieren aus.
            </p>
            <div class="mt-6">
                <a href="/rulesets/import/scan" class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700">
                    <svg class="h-5 w-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M8 4a3 3 0 00-3 3v4a5 5 0 0010 0V7a3 3 0 00-3-3H8z"/>
                        <path d="M6 2a2 2 0 00-2 2v4a2 2 0 002 2V4h10V2a2 2 0 00-2-2H6z"/>
                    </svg>
                    Verzeichnisse durchsuchen
                </a>
            </div>
            <div class="mt-4 text-xs text-gray-500">
                Durchsucht: <code class="bg-gray-100 px-2 py-1 rounded">rulesets/</code>
            </div>
        </div>
    </div>

    <!-- Upload-Form -->
    <div id="content-upload" class="tab-content hidden">
        <form method="post" action="/rulesets/import/upload" enctype="multipart/form-data" class="space-y-6">
            <div>
                <label for="file" class="block text-sm font-medium text-gray-700 mb-2">
                    YAML-Datei ausw√§hlen *
                </label>
                <input
                    type="file"
                    id="file"
                    name="file"
                    accept=".yaml,.yml"
                    required
                    class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500"
                >
                <p class="mt-1 text-xs text-gray-500">Unterst√ºtzte Formate: .yaml, .yml</p>
            </div>

            <div>
                <label for="event_id_upload" class="block text-sm font-medium text-gray-700 mb-2">
                    Veranstaltung zuordnen (optional)
                </label>
                <select
                    id="event_id_upload"
                    name="event_id"
                    class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500"
                >
                    <option value="">Keine Zuordnung</option>
                    {% for event in events %}
                    <option value="{{ event.id }}">{{ event.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <button
                type="submit"
                class="w-full px-6 py-3 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition font-medium"
            >
                Datei hochladen und importieren
            </button>
        </form>
    </div>

    <!-- GitHub-Form -->
    <div id="content-github" class="tab-content hidden">
        <form method="post" action="/rulesets/import/github" class="space-y-6">
            <div>
                <label for="github_url" class="block text-sm font-medium text-gray-700 mb-2">
                    GitHub-URL zur YAML-Datei *
                </label>
                <input
                    type="url"
                    id="github_url"
                    name="github_url"
                    placeholder="https://raw.githubusercontent.com/user/repo/main/ruleset.yaml"
                    required
                    class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500"
                >
                <p class="mt-1 text-xs text-gray-500">
                    Beispiel: https://raw.githubusercontent.com/user/repo/main/kinder_2024.yaml
                </p>
            </div>

            <div>
                <label for="event_id_github" class="block text-sm font-medium text-gray-700 mb-2">
                    Veranstaltung zuordnen (optional)
                </label>
                <select
                    id="event_id_github"
                    name="event_id"
                    class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500"
                >
                    <option value="">Keine Zuordnung</option>
                    {% for event in events %}
                    <option value="{{ event.id }}">{{ event.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <button
                type="submit"
                class="w-full px-6 py-3 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition font-medium"
            >
                Von GitHub importieren
            </button>
        </form>
    </div>

    <!-- Manual-Form -->
    <div id="content-manual" class="tab-content hidden">
        <form method="post" action="/rulesets/import/manual" class="space-y-6">
            <div>
                <label for="yaml_content" class="block text-sm font-medium text-gray-700 mb-2">
                    YAML-Inhalt *
                </label>
                <textarea
                    id="yaml_content"
                    name="yaml_content"
                    rows="20"
                    required
                    placeholder="name: &quot;Kinderfreizeit 2024&quot;&#10;type: &quot;kinder&quot;&#10;valid_from: &quot;2024-01-01&quot;&#10;valid_until: &quot;2024-12-31&quot;&#10;&#10;age_groups:&#10;  - min_age: 6&#10;    max_age: 9&#10;    price: 140.00&#10;..."
                    class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500 font-mono text-sm"
                ></textarea>
            </div>

            <div>
                <label for="event_id_manual" class="block text-sm font-medium text-gray-700 mb-2">
                    Veranstaltung zuordnen (optional)
                </label>
                <select
                    id="event_id_manual"
                    name="event_id"
                    class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500"
                >
                    <option value="">Keine Zuordnung</option>
                    {% for event in events %}
                    <option value="{{ event.id }}">{{ event.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <button
                type="submit"
                class="w-full px-6 py-3 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition font-medium"
            >
                Regelwerk speichern
            </button>
        </form>
    </div>
</div>

<!-- Beispiel-Regelwerk -->
<div class="bg-gray-50 shadow rounded-lg p-6">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">üìã Beispiel-Regelwerk</h3>
    <pre class="bg-white p-4 rounded border border-gray-200 overflow-x-auto text-sm"><code>name: "Kinderfreizeit 2024"
type: "kinder"
valid_from: "2024-01-01"
valid_until: "2024-12-31"

age_groups:
  - min_age: 6
    max_age: 9
    price: 140.00
  - min_age: 10
    max_age: 12
    price: 150.00

role_discounts:
  betreuer:
    discount_percent: 50
    max_count: 10
  kueche:
    discount_percent: 100
    max_count: 2

family_discount:
  enabled: true
  second_child_percent: 10
  third_plus_child_percent: 20
</code></pre>
    <div class="mt-4 text-sm text-gray-600">
        <p><strong>Pflichtfelder:</strong> name, type, valid_from, valid_until, age_groups</p>
        <p><strong>Optional:</strong> role_discounts, family_discount</p>
    </div>
</div>

<script>
function switchTab(tab) {
    // Alle Tab-Buttons zur√ºcksetzen
    document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('border-purple-600', 'text-purple-600');
        btn.classList.add('border-transparent', 'text-gray-500');
    });

    // Alle Tab-Contents verstecken
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.add('hidden');
    });

    // Aktiven Tab anzeigen
    document.getElementById(`tab-${tab}`).classList.remove('border-transparent', 'text-gray-500');
    document.getElementById(`tab-${tab}`).classList.add('border-purple-600', 'text-purple-600');
    document.getElementById(`content-${tab}`).classList.remove('hidden');
}
</script>
{% endblock %}
